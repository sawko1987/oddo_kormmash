# Инструкция по тестированию создания производственных заказов

## Проблема
После парсинга XLS и выбора машины в производство отправляется только первый уровень изделия, а входящие в него изделия (подсборки) и компоненты не отправляются.

## Как протестировать

### 1. Создайте продукт с BOM через интерфейс Odoo

1. Откройте Odoo: http://localhost:8069
2. Перейдите в **Manufacturing → Products → Products**
3. Создайте новый продукт:
   - Name: "Тестовое главное изделие"
   - Type: Storable Product
   - Internal Reference: TEST_MAIN_001

4. Создайте компонент (подсборку):
   - Name: "Тестовая подсборка"
   - Type: Storable Product
   - Internal Reference: TEST_SUB_001

5. Создайте BOM для подсборки:
   - Manufacturing → Bills of Materials → Create
   - Product: Тестовая подсборка
   - Components: добавьте любой материал (например, создайте продукт "Материал 1")

6. Создайте BOM для главного изделия:
   - Manufacturing → Bills of Materials → Create
   - Product: Тестовое главное изделие
   - Components: добавьте "Тестовая подсборка"

7. Убедитесь, что оба продукта имеют маршрут Manufacture:
   - Откройте продукт → вкладка Inventory → Routes
   - Убедитесь, что установлена галочка "Manufacture"

### 2. Создайте производственный заказ

1. Manufacturing → Manufacturing Orders → Create
2. Product: Тестовое главное изделие
3. Quantity: 5
4. Нажмите **Confirm**

### 3. Проверьте логи

Откройте терминал и выполните:

```bash
tail -f "/home/sawko1987/ Odoo/var/odoo.log" | grep -E "(НАЧАЛО ПОДТВЕРЖДЕНИЯ|СОЗДАНИЕ ВЛОЖЕННЫХ|Проверка компонентов|Найдено компонентов|Компонент.*BOM|маршрут Manufacture|Создан производственный заказ)"
```

### 4. Проверьте созданные заказы

После подтверждения главного заказа:

1. Manufacturing → Manufacturing Orders
2. Проверьте, создан ли заказ для "Тестовая подсборка"
3. Если заказ не создан, проверьте логи на наличие ошибок

## Что искать в логах

1. **"НАЧАЛО ПОДТВЕРЖДЕНИЯ ПРОИЗВОДСТВЕННОГО ЗАКАЗА"** - начало процесса
2. **"СОЗДАНИЕ ВЛОЖЕННЫХ ПРОИЗВОДСТВЕННЫХ ЗАКАЗОВ"** - начало создания вложенных заказов
3. **"Проверка компонентов"** - проверка каждого компонента
4. **"Компонент ... BOM=..."** - детали каждого компонента
5. **"Найдено компонентов, требующих производства"** - количество найденных компонентов
6. **"Создан производственный заказ"** - успешное создание заказа

## Возможные проблемы

1. **Компоненты не найдены**:
   - Проверьте, что подсборка имеет BOM типа 'normal'
   - Проверьте, что подсборка имеет маршрут Manufacture

2. **Заказ не создается**:
   - Проверьте логи на наличие ошибок
   - Убедитесь, что у пользователя есть права на создание производственных заказов

3. **Дублирование заказов**:
   - Метод проверяет существующие заказы перед созданием
   - Если заказ уже создан через procurement, новый не создается
