# Настройка интеграции закупок с производством (MRP)

## Обзор

Модуль `purchase_mrp` обеспечивает автоматическую связь между производственными заказами и заказами на закупку материалов.

## Установка модуля

Модуль `purchase_mrp` устанавливается автоматически при установке `purchase` и `mrp`.

Проверка установки:
```bash
python3 check_installed_modules.py
```

Или через интерфейс: **Apps → Purchase and MRP Management**

## Логика работы

### Автоматическое создание заказов на закупку

1. **Создание производственного заказа**
   - Система анализирует спецификацию (BOM)
   - Проверяет наличие материалов на складе

2. **Расчет потребности**
   - Определяет недостающие материалы
   - Учитывает резервирование для других заказов

3. **Создание предложений закупки**
   - Для каждого недостающего материала создается предложение
   - Предложение содержит:
     - Продукт
     - Необходимое количество
     - Срок поставки (на основе даты производства)
     - Связь с производственным заказом

4. **Подтверждение снабженцем**
   - Снабженец просматривает предложения
   - Подтверждает или корректирует заказы
   - Создает заказы на закупку

## Настройка продуктов для производства

### Для материалов, которые закупаются

1. Откройте карточку продукта
2. Перейдите на вкладку **Inventory**
3. Убедитесь, что:
   - **Type**: Storable Product
   - **Route**: включен маршрут **Buy**
   - **Route**: отключен маршрут **Manufacture** (если продукт не производится)

4. На вкладке **Purchase**:
   - Укажите **Vendor** (поставщика по умолчанию)
   - Настройте **Purchase Lead Time** (срок поставки)

### Для продуктов, которые производятся

1. В карточке продукта:
   - **Type**: Storable Product
   - **Route**: включен маршрут **Manufacture**
   - **Route**: отключен маршрут **Buy**

2. На вкладке **Manufacturing**:
   - Создайте или укажите **Bill of Materials (BOM)**
   - Настройте **Routing** (маршрут производства)

## Настройка спецификаций (BOM)

1. Перейдите в **Manufacturing → Products → Bills of Materials**
2. Создайте или откройте спецификацию
3. Добавьте компоненты:
   - **Component**: продукт-компонент
   - **Quantity**: количество на единицу готового продукта
   - **UoM**: единица измерения

4. Для каждого компонента убедитесь:
   - Продукт имеет маршрут **Buy**
   - Указан поставщик по умолчанию
   - Настроен срок поставки

## Примеры настройки

### Пример 1: Простой производственный заказ

**Готовый продукт:** Сборочный узел
**BOM:**
- Металл листовой: 10 кг
- Болты М8: 20 шт
- Подшипник: 2 шт

**Настройка:**
1. Все компоненты имеют маршрут **Buy**
2. Для каждого компонента указан поставщик
3. При создании производственного заказа система автоматически создаст предложения закупки для недостающих материалов

### Пример 2: Многоуровневая спецификация

**Готовый продукт:** Готовая машина
**BOM уровня 1:**
- Сборочный узел (производится)
- Рама (производится)
- Электродвигатель (закупается)

**BOM сборочного узла:**
- Металл: 50 кг
- Крепеж: 100 шт

**Настройка:**
1. Система автоматически рассчитывает потребность на всех уровнях
2. Создает предложения закупки для всех закупаемых компонентов
3. Учитывает сроки поставки на каждом уровне

## Мониторинг и управление

### Просмотр предложений закупки

1. Перейдите в **Purchase → Requests for Quotation**
2. Фильтр по статусу: **Draft** (черновики)
3. Проверьте предложения, созданные из производственных заказов

### Связь с производственным заказом

В заказе на закупку:
- Поле **Source Document** показывает связанный производственный заказ
- Можно перейти к производственному заказу по ссылке

В производственном заказе:
- Вкладка **Components** показывает компоненты
- Кнопка **Purchase Orders** показывает связанные заказы на закупку
- Статус компонентов показывает, какие материалы заказаны

## Автоматизация

### Автоматическое создание заказов

Для автоматического создания заказов без подтверждения:

1. Настройте точки заказа (Reorder Points) для компонентов
2. Установите **Trigger**: Auto
3. Система будет автоматически создавать заказы при недостатке материалов

**Внимание:** Используйте с осторожностью, так как это может привести к избыточным заказам.

### Ручное подтверждение (рекомендуется)

1. Настройте точки заказа с **Trigger**: Manual
2. Система создает предложения
3. Снабженец проверяет и подтверждает заказы
4. Это позволяет контролировать закупки и оптимизировать объемы

## Отчеты

- **Manufacturing → Reporting → Manufacturing Orders**: отчет по производственным заказам
- **Purchase → Reporting → Purchase Analysis**: анализ закупок по производственным заказам
- **Inventory → Reporting → Forecast Report**: прогноз потребности в материалах

## Рекомендации

1. **Всегда указывайте поставщиков по умолчанию** для закупаемых компонентов
2. **Настройте реалистичные сроки поставки** для точного планирования
3. **Используйте точки заказа** для критичных материалов
4. **Регулярно проверяйте предложения закупки** перед подтверждением
5. **Мониторьте связь** между производственными заказами и заказами на закупку
