# Настройка автоматических уведомлений и напоминаний

## Обзор

Odoo предоставляет встроенные механизмы автоматизации для:
- Отправки уведомлений поставщикам
- Напоминаний о сроках поставки
- Уведомлений о статусах заказов
- Автоматических отчетов

## Встроенные автоматизации

### 1. Напоминания о поставках (Receipt Reminder)

**Описание:** Автоматическая отправка напоминаний поставщикам о сроках поставки.

**Настройка:**
1. Перейдите в **Settings → Purchase**
2. Включите опцию **Receipt Reminder**
3. Настройте параметры напоминания в карточке поставщика:
   - **Reminder Date Before Receipt**: количество дней до поставки для отправки напоминания

**Как работает:**
- Система автоматически отправляет email поставщику за указанное количество дней до запланированной даты поставки
- Напоминание отправляется один раз для каждого заказа

**Настройка для поставщика:**
1. Откройте карточку поставщика
2. Перейдите на вкладку **Purchase**
3. Укажите **Reminder Date Before Receipt** (например, 3 дня)
4. Сохраните

### 2. Автоматическая отправка RFQ

**Описание:** При создании запроса предложений (RFQ) система автоматически отправляет его поставщику.

**Настройка:**
1. Создайте RFQ (Request for Quotation)
2. Нажмите **Send by Email**
3. Система автоматически отправит RFQ поставщику

**Шаблоны email:**
- Настраиваются в **Settings → Technical → Email → Mail Templates**
- Шаблон: **Purchase: Request for Quotation**

### 3. Уведомления о статусах заказов

**Описание:** Автоматические уведомления при изменении статуса заказа.

**Настройка:**
1. Перейдите в **Settings → Technical → Email → Mail Templates**
2. Найдите шаблоны для заказов на закупку:
   - **Purchase: RFQ Confirmation**
   - **Purchase: RFQ Approved**
   - **Purchase: Purchase Order**

3. Настройте шаблоны по необходимости

**Автоматические уведомления:**
- При подтверждении RFQ
- При утверждении заказа
- При отправке заказа поставщику
- При получении товара

## Настройка кастомных автоматизаций

### Создание Scheduled Action (Планируемое действие)

1. Перейдите в **Settings → Technical → Automation → Scheduled Actions**
2. Нажмите **Create**
3. Заполните:
   - **Name**: название действия
   - **Model**: модель (например, purchase.order)
   - **Trigger**: тип триггера
     - **On Creation**: при создании записи
     - **On Update**: при обновлении записи
     - **On Deletion**: при удалении записи
     - **Based on Form View**: на основе формы
     - **Based on Time Condition**: по времени
   - **Code**: Python код для выполнения

### Пример 1: Напоминание о заказах на утверждение

**Цель:** Ежедневно отправлять email менеджерам о заказах, требующих утверждения.

**Настройка:**
1. Создайте Scheduled Action
2. **Name**: Daily Purchase Approval Reminder
3. **Model**: purchase.order
4. **Trigger**: Based on Time Condition
5. **Interval**: Daily
6. **Code**:
```python
# Найти заказы на утверждение
orders_to_approve = records.search([
    ('state', '=', 'to approve'),
    ('amount_total', '>', 50000)  # Только крупные заказы
])

# Отправить уведомление менеджерам
if orders_to_approve:
    managers = records.env['res.users'].search([
        ('groups_id', 'in', [records.env.ref('purchase.group_purchase_manager').id])
    ])
    # Логика отправки email
    # ...
```

### Пример 2: Напоминание о просроченных поставках

**Цель:** Ежедневно проверять заказы с просроченными поставками и отправлять напоминания.

**Настройка:**
1. Создайте Scheduled Action
2. **Name**: Overdue Delivery Reminder
3. **Model**: purchase.order
4. **Trigger**: Based on Time Condition
5. **Interval**: Daily
6. **Code**:
```python
# Найти заказы с просроченными поставками
today = fields.Date.today()
overdue_orders = records.search([
    ('state', 'in', ['purchase', 'done']),
    ('date_planned', '<', today),
    ('qty_received', '<', records.order_line.product_qty)
])

# Отправить напоминания поставщикам
for order in overdue_orders:
    # Логика отправки напоминания
    # ...
```

### Пример 3: Автоматическое создание заказов при низком остатке

**Цель:** Автоматически создавать заказы на закупку при достижении минимального уровня запаса.

**Настройка:**
1. Используйте встроенные точки заказа (Reorder Points)
2. Настройте **Trigger**: Auto
3. Система автоматически создаст заказы

**Альтернатива через код:**
```python
# Найти продукты с низким остатком
orderpoints = records.env['stock.warehouse.orderpoint'].search([
    ('trigger', '=', 'auto'),
    ('qty_on_hand', '<=', records.product_min_qty)
])

# Создать заказы на закупку
for orderpoint in orderpoints:
    # Логика создания заказа
    # ...
```

## Настройка Email-шаблонов

### Редактирование шаблонов

1. Перейдите в **Settings → Technical → Email → Mail Templates**
2. Найдите нужный шаблон (например, Purchase: Request for Quotation)
3. Нажмите **Edit**
4. Настройте:
   - **Subject**: тема письма
   - **Body**: тело письма (можно использовать переменные)
5. Сохраните

### Переменные в шаблонах

Доступные перемени для заказов на закупку:
- `${object.name}` - номер заказа
- `${object.partner_id.name}` - название поставщика
- `${object.amount_total}` - общая сумма
- `${object.date_planned}` - запланированная дата поставки
- `${object.order_line}` - строки заказа

### Пример кастомного шаблона

**Subject:** Запрос предложения #${object.name}

**Body:**
```
Уважаемый ${object.partner_id.name}!

Просим предоставить предложение по следующим позициям:

% for line in object.order_line:
- ${line.product_id.name}: ${line.product_qty} ${line.product_uom.name}
% endfor

Срок поставки: ${object.date_planned}

С уважением,
${user.name}
```

## Настройка уведомлений для пользователей

### Email-уведомления в Chatter

Odoo автоматически отправляет уведомления в Chatter при:
- Создании заказа
- Изменении статуса
- Добавлении комментариев
- Прикреплении файлов

**Настройка:**
1. Перейдите в **Settings → Users & Companies → Users**
2. Откройте карточку пользователя
3. На вкладке **Preferences**:
   - **Email**: укажите email для уведомлений
   - **Notification**: выберите тип уведомлений
     - **Handle by Odoo**: уведомления в Odoo
     - **Email**: уведомления по email
     - **Handle by Odoo and Email**: оба варианта

### Подписки на уведомления

Пользователи автоматически подписываются на уведомления о:
- Заказах, которые они создали
- Заказах, где они указаны как ответственные
- Заказах, связанных с их отделом

## Рекомендации по автоматизации

1. **Не перегружайте уведомлениями**
   - Настройте фильтры для важных уведомлений
   - Используйте приоритеты

2. **Тестируйте автоматизации**
   - Проверьте работу на тестовых данных
   - Убедитесь, что email доставляются корректно

3. **Документируйте кастомные автоматизации**
   - Описывайте назначение каждой автоматизации
   - Указывайте условия срабатывания

4. **Мониторьте производительность**
   - Проверяйте логи выполнения
   - Оптимизируйте код при необходимости

5. **Регулярно проверяйте настройки**
   - Убедитесь, что автоматизации работают корректно
   - Обновляйте при изменении процессов

## Проверка работы автоматизаций

### Логи выполнения

1. Перейдите в **Settings → Technical → Automation → Scheduled Actions**
2. Откройте действие
3. Проверьте **Last Run** и **Next Run**
4. Просмотрите логи в **Settings → Technical → Logging**

### Тестирование

1. Создайте тестовый заказ
2. Проверьте отправку уведомлений
3. Убедитесь, что все работает корректно
4. При необходимости скорректируйте настройки
